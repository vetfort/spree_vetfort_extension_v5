<%= stylesheet_link_tag 'spree/storefront/spree_vetfort_extension_v5', media: 'all' %>

<script type="module">
  import PubSub from "https://esm.sh/pubsub-js@1.9.4"
  window.VetfortDeps ||= {}
  window.VetfortDeps.PubSub = PubSub

  import AiChatController from "<%= asset_path 'spree/storefront/spree_vetfort_extension_v5/ai_chat_controller.js' %>"
  import AiChatHeroController from "<%= asset_path 'spree/storefront/spree_vetfort_extension_v5/ai_chat/hero_controller.js' %>"
  import MessageHistory from "<%= asset_path 'spree/storefront/spree_vetfort_extension_v5/ai_chat/message_history_controller.js' %>"
  import FormController from "<%= asset_path 'spree/storefront/spree_vetfort_extension_v5/ai_chat/form_controller.js' %>"

  import * as VetfortConstants from "<%= asset_path 'spree/storefront/spree_vetfort_extension_v5/constants.js' %>"
  import * as VetfortApi from "<%= asset_path 'spree/storefront/spree_vetfort_extension_v5/services/api.js' %>"
  import * as ChatStateManager from "<%= asset_path 'spree/storefront/spree_vetfort_extension_v5/services/chat_state_manager.js' %>"
  import * as ScrollManager from "<%= asset_path 'spree/storefront/spree_vetfort_extension_v5/services/scroll_manager.js' %>"

  window.VetfortDeps.Constants = VetfortConstants
  window.VetfortDeps.Api = VetfortApi
  window.VetfortDeps.ChatStateManager = ChatStateManager
  window.VetfortDeps.ScrollManager = ScrollManager

  document.addEventListener('turbo:load', () => {
    const app = window.Stimulus || null
    if (app) {
      app.register('ai-chat', AiChatController)
      app.register('ai-chat--hero', AiChatHeroController)
      app.register('ai-chat--message-history', MessageHistory)
      app.register('ai-chat--form', FormController)
    }
  })
</script>
